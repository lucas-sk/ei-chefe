---
interface Props {
  pixelId: string;
}
const { pixelId } = Astro.props;
---

<script is:inline define:vars={{ pixelId }}>
  // Lazy load Meta Pixel após interação do usuário ou timeout
  (function() {
    var loaded = false;

    function loadFBPixel() {
      if (loaded) return;
      loaded = true;

      !(function (f, b, e, v, n, t, s) {
        if (f.fbq) return;
        n = f.fbq = function () {
          n.callMethod ? n.callMethod.apply(n, arguments) : n.queue.push(arguments);
        };
        if (!f._fbq) f._fbq = n;
        n.push = n;
        n.loaded = !0;
        n.version = '2.0';
        n.queue = [];
        t = b.createElement(e);
        t.async = !0;
        t.src = v;
        t.defer = true;
        s = b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t, s);
      })(
        window,
        document,
        'script',
        'https://connect.facebook.net/en_US/fbevents.js'
      );

      var url = window.location.origin + '?ob=open-bridge';
      fbq('init', pixelId, {}, { agent: 'wordpress-6.8.1-4.0.1' });
      fbq('track', 'PageView');
      fbq('set', 'openbridge', pixelId, url);
    }

    // Carregar após 3s de inatividade ou primeira interação
    var timeout = setTimeout(loadFBPixel, 3000);

    ['mousedown', 'touchstart', 'scroll'].forEach(function(event) {
      window.addEventListener(event, function() {
        clearTimeout(timeout);
        loadFBPixel();
      }, { once: true, passive: true });
    });
  })();
</script>
<!-- Meta Pixel Code -->
<noscript>
  <img
    height="1"
    width="1"
    style="display:none"
    alt="fbpx"
    src="https://www.facebook.com/tr?id=640767321129181&ev=PageView&noscript=1"
  />
</noscript>
<!-- End Meta Pixel Code -->
